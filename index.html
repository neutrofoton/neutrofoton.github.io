
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>neutrofoton</title>
  <meta name="author" content="neutro">

  
  <meta name="description" content="while visiting clients of the company I work on, sometime I still found some applications especially desktop application build on unmanaged code ( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://neutrofoton.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="neutrofoton" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<style>
article img {
  border: 0;
}
aside.sidebar img {
  border-color: #e0e0e0;
}
article img, article video, article .flash-video{
  box-shadow: rgba(255,255,255,0.15) 0 1px 4px;
}
</style>

<!-- badge -->
<style type="text/css">
  .badge1 {
  position:relative;
  }
  .badge1[data-badge]:after {
  content: attr(data-badge);
  position: absolute;
  /*top: -10px;*/
  right: -30px;
  font-size: .7em;
  background: #c57373;
  color: white;
  /* width: 18px; */
  min-width: 18px;
  height: 18px;
  text-align: center;
  line-height: 18px;
  border-radius: 450%;
  box-shadow: 0 0 1px #333;

  padding: 2px;
  }
</style>

  


  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">neutrofoton</a></h1>
  
    <h2>Science, Technology and Life</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="neutrofoton.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <!--<li><a href="/about">About</a></li>-->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/14/create-and-consume-c-plus-plus-class-dll-on-windows/">Create and Consume C++ Class DLL on Windows</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-14T14:04:05+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:04 pm</span></time>
        
           | <a href="/blog/2017/09/14/create-and-consume-c-plus-plus-class-dll-on-windows/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2017/09/14/create-and-consume-c-plus-plus-class-dll-on-windows/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/cpp.png"></p>

<p>while visiting clients of the company I work on, sometime I still found some applications especially desktop application build on unmanaged code (such as Delphi, Visual Basic 6, C++, etc). Even though at the time of this blog post, many application build on .NET (managed code) on Windows platform. There are various reasons why they do not migrate to managed code which has some advantages over unmanaged code (such as the application still run well with the version of OS they use, rewrite app will need extra cost, etc). This means unmanaged code application is not dead at all for LOB app, even though the percentage is much lower than the managed one.</p>

<p>Maybe this topic seems out of date topic in the .NET era, but at least this post as a note for my self in case I need it on the other day.</p>

<p>While developing an application, usually we want to share some of our code with other application. Dynamic Link Library (DLL) is Microsoft&rsquo;s implementation of the shared library concept in the Microsoft Windows. The term DLL in this post will refer to unmanaged code and only focus to the one build with Visual C++ compiler on Windows environment.</p>

<p>When we create a DLL, we also create a .lib file that contains information of exported class or functions. When we build an executable that calls the DLL, the linker uses the exported symbols in the .lib file to store this information for the loader. When the loader loads a DLL, the DLL is mapped into the memory space of the executable.</p>

<p>An executable file links to (or loads) a DLL in one of two ways, <em>implicit</em> or <em>explicit linking</em>. In this post will create simple sample both of them how C++ class exported in the two ways. The samples in this post created using IDE Microsoft Visual Studio 2013 Ultimate. To simplify the code, I just created a single solution contains a Win32 DLL project and a console application client. The DLL project contains classes for both sample <em>implicit</em> and <em>explicit linking</em>. Either the console application contains sample code for <em>implicit</em> and <em>explicit linking</em> caller. Here is the classes I use in this sample.</p>

<p><img class="center" src="/images/post/2017-09-04-classdiagram.png"></p>

<h2>Implicit Linking</h2>

<p><em>Implicit linking</em>, where the operating system loads the DLL when the executable using it is loaded. The executable client calls the exported functions of the DLL just as if the functions were statically linked and contained within the executable. <em>Implicit linking</em> is sometimes referred to as static load or load-time dynamic linking<sup>[4]</sup>. Now let&rsquo;s create a sample of DLL with <em>implicit linking</em>.</p>

<p>First of all, create an empty solution in Visual Studio by selecting <code>File</code> > <code>New Project</code> > scroll down on the left pane, expand <code>Other Project Types</code> > <code>Visual Studio Solutions</code> select <code>Black Solution</code>. Fill the solution name as <code>VCppDLL</code>.</p>

<p>Now we have an empty solution in Visual Studio. Right click the <code>VCppDLL</code> solution > <code>Add</code> > <code>New Project</code>. In the left pane of the New Project dialog box, expand Installed templates <code>Visual C++</code>, and then select <code>Win32</code>. Fill the project name as <strong>MathWin32DLL</strong>, then click OK.</p>

<p>On the Win32 Application Wizard dialog in the <code>Application Settings</code> part, select <code>DLL</code> and check <code>Empty project</code>, then click Finish</p>

<p><img class="center" src="/images/post/2017-09-04-Win32AppWizard.png"></p>

<p>Now we have an empty C++ DLL project in the Visual Studio solution. As the class diagram picture above, let create a simple <code>BaseMath</code> class. Right click the MathWin32DLL project > <code>Add</code> > <code>Class</code>. On <code>Visual C++</code> template on the left pane dialog, select <code>C++ Class</code> > click <code>Add</code>. On the <code>Generic C++ Class Wizard</code>, fill the <code>Class name</code> as <strong>BaseMath</strong> then click <code>Finish</code>. Edit the <code>BaseMath.h</code> with the following code.</p>

<figure class='code'><figcaption><span>BaseMath.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">// If you are building the DLL project on the command line,</span>
</span><span class='line'><span class="c1">// use the /D compiler option to define the MATHDLLWIN32_EXPORTS symbol.</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma once</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef MATHWIN32DLL_EXPORTS</span>
</span><span class='line'><span class="cp">#define Math_API __declspec(dllexport)</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'><span class="cp">#define Math_API __declspec(dllimport)</span>
</span><span class='line'><span class="cp">#endif </span><span class="c1">// MATHWIN32DLL_EXPORTS</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">core</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">BaseMath</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>      <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Destroy</span><span class="p">()</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">delete</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">virtual</span> <span class="n">string</span> <span class="n">Say</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">virtual</span> <span class="kt">double</span> <span class="n">Calculate</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can delete <code>BaseMath.cpp</code> file since we will make the <code>BaseMath</code> as an <em>abstract class</em>.</p>

<p>In Visual Studio, by default the New Project template for a DLL adds PROJECTNAME_EXPORTS to the defined preprocessor symbols for the DLL project. We can see the preprocessor symbols definition in <code>Property Pages</code> of <strong>MathWin32DLL</strong> project in the <code>Configuration Properties</code> > <code>C/C++</code> > <code>Preposesor</code> > <code>Preposesor Definitions</code>.</p>

<p><img class="center" src="/images/post/2017-09-04-preposesordefinitions.png"></p>

<p>In the code of <code>BaseMath.h</code>, when <code>MATHWIN32DLL_EXPORTS</code> symbol is defined, the <code>Math_API</code> symbol is set to <code>__declspec(dllexport)</code> modifier otherwise it is set to <code>__declspec(dllimport)</code>. The <code>__declspec(dllexport)</code> modifier can be applied to classes, functions, or variables that tells the compiler and linker to export them from the DLL so that it can be used by other applications.</p>

<p>Meanwhile when we include <code>BaseMath.h</code> in client project, <code>Math_API</code> is set to <code>__declspec(dllimport)</code>. This modifier optimizes the import of the exported class in an application.</p>

<p>For the next, let&rsquo;s create another class called <code>AddOperationMath</code>. Edit the <code>AddOperationMath.h</code> and <code>AddOperationMath.cpp</code> respectively as follow.</p>

<figure class='code'><figcaption><span>AddOperationMath.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#pragma once</span>
</span><span class='line'><span class="cp">#include &quot;BaseMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">core</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">// MS Visual C++ compiler emits C4275 warning about not exported base class.</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Math_API</span> <span class="nl">AddOperationMath</span> <span class="p">:</span> <span class="k">public</span> <span class="n">BaseMath</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>      <span class="n">AddOperationMath</span><span class="p">();</span>
</span><span class='line'>      <span class="k">virtual</span> <span class="o">~</span><span class="n">AddOperationMath</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="n">string</span> <span class="nf">Say</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>      <span class="kt">double</span> <span class="nf">Calculate</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">static</span> <span class="kt">double</span> <span class="nf">Add</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>AddOperationMath.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &quot;AddOperationMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">core</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">AddOperationMath</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">AddOperationMath</span><span class="o">::~</span><span class="n">AddOperationMath</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">string</span> <span class="n">AddOperationMath</span><span class="o">::</span><span class="n">Say</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">string</span> <span class="n">result</span> <span class="o">=</span>  <span class="n">s</span> <span class="o">+</span> <span class="s">&quot; is calling add operation of class AddOperationMath&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">double</span> <span class="n">AddOperationMath</span><span class="o">::</span><span class="n">Calculate</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">double</span> <span class="n">AddOperationMath</span><span class="o">::</span><span class="n">Add</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The class <code>AddOperationMath</code> inherits from <code>BaseMath</code>. We also mark the <code>AddOperationMath</code> class with <code>Math_API</code> macro that&rsquo;s defined in <code>BaseMath.h</code> which means we will expose the <code>AddOperationMath</code> class in the DLL to executable client application. When we compile the DLL project, we should get a warning</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>warning C4275: non dll-interface class &#39;core::BaseMath&#39; used as base for dll-interface class &#39;core::AddOperationMath&#39;
</span></code></pre></td></tr></table></div></figure>


<p>In this case, ideally we should export (mark with <code>Math_API</code> macro) both <code>core::BaseMath</code> and <code>core::AddOperationMath</code> to make the compiler does not fire the warning message.</p>

<p>To complete our sample, let&rsquo;s create another project called <strong><em>MathWin32ClientConsole</em></strong> as we did the creation of <strong><em>MathWin32DLL</em></strong> project, except select <code>Console Application</code> instead of <code>DLL</code> in the <code>Application Settings</code> dialog.</p>

<p>In the <strong><em>MathWin32ClientConsole</em></strong> project, right click > <code>Add</code> > <code>New Item</code>. Select <code>Visual C++</code> project template on the left pane, then select <code>C++ File (.cpp)</code>. Fill the name with <code>Main.cpp</code>.</p>

<p>To make the <strong><em>MathWin32ClientConsole</em></strong> project has reference to <strong><em>MathWin32DLL</em></strong> project, right click <strong><em>MathWin32ClientConsole</em></strong> project > <code>Properties</code>. Scroll up the <code>Property Pages</code> dialog, expand <code>Common Properties</code> on the left pane > select <code>References</code>. Click <code>Add New Reference</code> button, select <code>Projects</code> and check the <code>MathWin32DLL</code> > <code>OK</code>. Now you should see <code>MathWin32DLL</code> added to the <code>References</code> pane as the following picture.</p>

<p> <img class="center" src="/images/post/2017-09-04-MathWin32ClientConsoleReference.png"></p>

<p> To make the <code>AddOperationMath</code> class is recognized in the <strong><em>MathWin32ClientConsole</em></strong> project, we have to include <code>AddOperationMath.h</code>. We can copy the <code>AddOperationMath.h</code> and <code>BaseMath.h</code> to the <strong><em>MathWin32ClientConsole</em></strong> project. But it is not a good way in our scenario, because if we make changes to one of them, we have to recopy it to the <strong><em>MathWin32ClientConsole</em></strong> project directory. To avoid this manual copy, we can include the <strong><em>MathWin32DLL</em></strong> project directory to the <strong><em>MathWin32ClientConsole</em></strong> so that we can include any header files of <strong><em>MathWin32DLL</em></strong> to <strong><em>MathWin32ClientConsole</em></strong> if needed. To do that open the Property pages of <strong><em>MathWin32ClientConsole</em></strong>, select <code>Configuration Properties</code> > <code>C/C++</code> > <code>General</code>. Select the drop-down control next to the <code>Additional Include Directories</code> edit box, and then choose <code>&lt;Edit...&gt;</code>. Select the top pane of the <code>Additional Include Directories</code> dialog box to enable an edit control. In the edit control, fill <code>$(SolutionDir)\MathWin32DLL</code> which tells to Visual Studio to scan or search header files that we include in directory <code>MathWin32DLL</code> inside solution directory.</p>

<p> <img class="center" src="/images/post/2017-09-04-IncludeMathWin32DLLDirectory.png"></p>

<p>Now we can include header file defined in <code>MathWin32DLL</code> from <code>MathWin32ClientConsole</code>. Let create code that call class defined in the DLL.</p>

<figure class='code'><figcaption><span>Main.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;AddOperationMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">CallDLLByImplicitLinking</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>  <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;neutro&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">CallDLLByImplicitLinking</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Press any key to exit &quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">CallDLLByImplicitLinking</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; + &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">core</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="o">::</span><span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">core</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="o">*</span> <span class="n">math</span> <span class="o">=</span> <span class="k">new</span> <span class="n">core</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="p">();</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">math</span><span class="o">-&gt;</span><span class="n">Say</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">delete</span> <span class="n">math</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;===============================================================&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>2 + 4 = 6
</span><span class='line'>neutro is calling add operation of class AddOperationMath
</span><span class='line'>
</span><span class='line'>Press any key to exit
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>There is no need to explicitly specify a calling convention for exporting classes or their methods. By default, the C++ compiler uses the <code>__thiscall</code> calling convention for class methods. However, due to different naming decoration schemes that are used by different compilers, the exported C++ class can only be used by the same compiler and by the same version of the compiler. Only the MS Visual C++ compiler can use this DLL now. Both the DLL and the client code must be compiled with the same version of MS Visual C++ in order to ensure that the naming decoration scheme matches between the caller and the callee<sup>[5]</sup></p></blockquote>

<p>To use a DLL by <em>implicit linking</em>, an executable must include the header files that declare the data, functions or C++ classes exported by the DLL in each source file that contains calls to the exported data, functions, and classes.  The classes, functions, and data exported by the DLL must all be marked <code>__declspec(dllimport)</code> in the header file. From a coding perspective, calls to the exported functions are just like any other function call.</p>

<p>To build the calling executable file, we must link with the import library (.lib). If we use an external makefile or build system, we need to specify the file name of the import library where we list other object (.obj) files or libraries that we link.</p>

<p>The operating system must be able to locate the DLL file when it loads the calling executable. This means that we must deploy or verify the existence of the DLL when our application is installed.</p>

<h2>Explicit Linking</h2>

<p><em>Explicit linking</em>, where the operating system loads the DLL on demand at runtime. An executable that uses a DLL by <em>explicit linking</em> must make function calls to explicitly load and unload the DLL and to access the functions exported by the DLL. Unlike calls to functions in a statically linked library, the client executable must call the exported functions in a DLL through a function pointer. <em>Explicit linking</em> is sometimes referred to as dynamic load or run-time dynamic linking<sup>[4]</sup>.</p>

<p>To use a DLL by <em>explicit linking</em>, applications must make a function call to explicitly load the DLL at run time. To explicitly link to a DLL, an application must <sup>[4]</sup>:</p>

<ol>
<li><p>Call <code>LoadLibrary</code>, <code>LoadLibraryEx</code>, or a similar function to load the DLL and obtain a module handle.</p></li>
<li><p>Call <code>GetProcAddress</code> to obtain a function pointer to each exported function that the application calls. Because applications call the DLL functions through a pointer, the compiler does not generate external references, so there is no need to link with an import library. However, you must have a typedef or using statement that defines the call signature of the exported functions that you call.</p></li>
<li><p>Call <code>FreeLibrary</code> when done with the DLL.</p></li>
</ol>


<p>To create a sample for <em>explicit linking</em>, we will use an abstract interface (a class with pure virtual methods, and no data) and create a factory method for object instantiation.</p>

<p>On the <strong><em>MathWin32DLL</em></strong> create a new class called <code>LogarithmicMath</code>. Edit the header and implementation files as follow</p>

<figure class='code'><figcaption><span>LogarithmicMath.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#pragma once</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;BaseMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">core</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">LogarithmicMath</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseMath</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>      <span class="n">LogarithmicMath</span><span class="p">();</span>
</span><span class='line'>      <span class="k">virtual</span> <span class="o">~</span><span class="n">LogarithmicMath</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="n">string</span> <span class="nf">Say</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>      <span class="kt">double</span> <span class="nf">Calculate</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>LogarithmicMath.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &quot;LogarithmicMath.h&quot;</span>
</span><span class='line'><span class="cp">#include &lt;math.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">core</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">LogarithmicMath</span><span class="o">::</span><span class="n">LogarithmicMath</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">LogarithmicMath</span><span class="o">::~</span><span class="n">LogarithmicMath</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">string</span> <span class="n">LogarithmicMath</span><span class="o">::</span><span class="n">Say</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">string</span> <span class="n">result</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot; is calling Logarithmic operation of class LogarithmicMath&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">double</span> <span class="n">LogarithmicMath</span><span class="o">::</span><span class="n">Calculate</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">log10</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">log10</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, create a <code>Factory</code> class that encapsulates <code>LogarithmicMath</code> instantiation and will be called from client app.</p>

<figure class='code'><figcaption><span>Factory.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &quot;BaseMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="n">Math_API</span> <span class="n">core</span><span class="o">::</span><span class="n">BaseMath</span><span class="o">*</span> <span class="kr">__cdecl</span> <span class="n">CreateLogarithmicMath</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Factory.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &quot;Factory.h&quot;</span>
</span><span class='line'><span class="cp">#include &quot;LogarithmicMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">core</span><span class="o">::</span><span class="n">BaseMath</span><span class="o">*</span> <span class="n">CreateLogarithmicMath</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">new</span> <span class="n">core</span><span class="o">::</span><span class="n">LogarithmicMath</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see that the <code>LogarithmicMath</code> class look like a standard C++ class. Instead of directly export the <code>LogarithmicMath</code> class, we use <code>Factory</code> that handle the export technics.</p>

<p>In the <code>Factory.h</code> defined <code>extern "C"</code> which tells the C++ compiler that the linker should use the C calling convention. It is required in order to prevent the mangling of the function name. So, this function is exposed as a regular C function, and can be easily recognized by any C-compatible compiler. The name itself is exported from the DLL unmangled (<code>CreateLogarithmicMath</code>). The <code>Math_API</code> tells the linker to export the <code>CreateLogarithmicMath</code> method from the DLL. <code>__cdecl</code> is the default calling convention for C and C++ programs.</p>

<p>Now let create a sample code in the <strong><em>MathWin32ClientConsole</em></strong> by editing the <code>Main.cpp</code> as following.</p>

<figure class='code'><figcaption><span>Main.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;Windows.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;AddOperationMath.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="n">core</span><span class="o">::</span><span class="n">BaseMath</span><span class="o">*</span> <span class="p">(</span><span class="kr">__cdecl</span> <span class="o">*</span><span class="n">LogarithmicMathFactory</span><span class="p">)();</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">CallDLLByImplicitLinking</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">CallDLLByExplicitLinking</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>  <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;neutro&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">CallDLLByImplicitLinking</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>  <span class="n">CallDLLByExplicitLinking</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Press any key to exit &quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">CallDLLByImplicitLinking</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; + &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">core</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="o">::</span><span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">core</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="o">*</span> <span class="n">math</span> <span class="o">=</span> <span class="k">new</span> <span class="n">core</span><span class="o">::</span><span class="n">AddOperationMath</span><span class="p">();</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">math</span><span class="o">-&gt;</span><span class="n">Say</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">delete</span> <span class="n">math</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;===============================================================&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">CallDLLByExplicitLinking</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">HMODULE</span> <span class="n">dll</span> <span class="o">=</span> <span class="n">LoadLibrary</span><span class="p">(</span><span class="s">L&quot;MathWin32DLL.dll&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dll</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Fail load library&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">LogarithmicMathFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">LogarithmicMathFactory</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetProcAddress</span><span class="p">(</span><span class="n">dll</span><span class="p">,</span> <span class="s">&quot;CreateLogarithmicMath&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">factory</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Unable to load CreateLogarithmicMath from DLL!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="n">FreeLibrary</span><span class="p">(</span><span class="n">dll</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">core</span><span class="o">::</span><span class="n">BaseMath</span><span class="o">*</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">factory</span><span class="p">();</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; log (&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;) = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">instance</span><span class="o">-&gt;</span><span class="n">Calculate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">instance</span><span class="o">-&gt;</span><span class="n">Say</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">instance</span><span class="o">-&gt;</span><span class="n">Destroy</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">FreeLibrary</span><span class="p">(</span><span class="n">dll</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;===============================================================&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now build and run the <strong><em>MathWin32ClientConsole</em></strong>, we should get the following output.</p>

<figure class='code'><figcaption><span>output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>2 + 4 = 6
</span><span class='line'>neutro is calling add operation of class AddOperationMath
</span><span class='line'>
</span><span class='line'>===============================================================
</span><span class='line'>2 log (4) = 2
</span><span class='line'>neutro is calling Logarithmic operation of class LogarithmicMath
</span><span class='line'>
</span><span class='line'>===============================================================
</span><span class='line'>Press any key to exit
</span></code></pre></td></tr></table></div></figure>


<p>In order to ensure proper resource release, an abstract interface provides an additional method for the disposal of an instance. In this case we provide <code>Destroy</code> method. Calling this method manually can be tedious and error prone. It&rsquo;s recommend use smart pointer for auto resource release instead of manual release.</p>

<p>The code of this article can be found <a href="https://github.com/neutrofoton/VCppDLL">here</a></p>

<h2>References New</h2>

<ol>
<li><a href="https://docs.microsoft.com/en-us/cpp/build/walkthrough-creating-and-using-a-dynamic-link-library-cpp">https://docs.microsoft.com/en-us/cpp/build/walkthrough-creating-and-using-a-dynamic-link-library-cpp</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/1ez7dh12.aspx">https://msdn.microsoft.com/en-us/library/1ez7dh12.aspx</a></li>
<li><a href="https://docs.microsoft.com/en-us/cpp/build/dlls-in-visual-cpp">https://docs.microsoft.com/en-us/cpp/build/dlls-in-visual-cpp</a></li>
<li><a href="https://docs.microsoft.com/en-us/cpp/build/linking-an-executable-to-a-dll#determining-which-linking-method-to-use">https://docs.microsoft.com/en-us/cpp/build/linking-an-executable-to-a-dll#determining-which-linking-method-to-use</a></li>
<li><a href="https://www.codeproject.com/Articles/28969/HowTo-Export-C-classes-from-a-DLL">https://www.codeproject.com/Articles/28969/HowTo-Export-C-classes-from-a-DLL</a></li>
<li><a href="http://eli.thegreenplace.net/2011/09/16/exporting-c-classes-from-a-dll">http://eli.thegreenplace.net/2011/09/16/exporting-c-classes-from-a-dll</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/10/winmerge-and-diffmerge-as-git-diff-merge-tool/">WinMerge and DiffMerge as Git Diff Merge Tool</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-05-10T11:01:23+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>11:01 am</span></time>
        
           | <a href="/blog/2017/05/10/winmerge-and-diffmerge-as-git-diff-merge-tool/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2017/05/10/winmerge-and-diffmerge-as-git-diff-merge-tool/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/git.png">
On software development while working with source control, it&rsquo;s inevitable sometime we get our code conflicts with other, since we work in a team. There are many diff and merge tools out there and some of them can be integrated with with Git. In this post I just want to note what I did in my development machine (Windows 7 and macOS Sierra)</p>

<h2>DiffMerge on macOS</h2>

<p>For my macOS development machine I use <a href="http://www.sourcegear.com/diffmerge/">DiffMerge</a>. Actually DiffMerge is not only available for macOS, but also for Windows and Linux. So we can use it as Git diff merge tool as well on Windows and Linux. To configure Git to use DiffMerge can be done by running the following command via terminal.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git config --global mergetool.prompt <span class="nb">false</span>
</span><span class='line'><span class="nv">$ </span>git config --global mergetool.keepBackup <span class="nb">false</span>
</span><span class='line'><span class="nv">$ </span>git config --global mergetool.keepTemporaries <span class="nb">false</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>git config --global diff.tool diffmerge
</span><span class='line'><span class="nv">$ </span>git config --global difftool.diffmerge.cmd <span class="s1">&#39;diffmerge &quot;$LOCAL&quot; &quot;$REMOTE&quot;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>git config --global merge.tool diffmerge
</span><span class='line'><span class="nv">$ </span>git config --global mergetool.diffmerge.cmd <span class="s1">&#39;diffmerge --merge --result=&quot;$MERGED&quot; &quot;$LOCAL&quot; &quot;$(if test -f &quot;$BASE&quot;; then echo &quot;$BASE&quot;; else echo &quot;$LOCAL&quot;; fi)&quot; &quot;$REMOTE&quot;&#39;</span>
</span><span class='line'><span class="nv">$ </span>git config --global mergetool.diffmerge.trustExitCode <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>The command will add the following config code in global <code>.gitconfig</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>mergetool<span class="o">]</span>
</span><span class='line'>  <span class="nv">prompt</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="nb">  </span><span class="nv">keepBackup</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="nb">  </span><span class="nv">keepTemporaries</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>diff<span class="o">]</span>
</span><span class='line'>  <span class="nv">tool</span> <span class="o">=</span> diffmerge
</span><span class='line'>
</span><span class='line'><span class="o">[</span>difftool <span class="s2">&quot;diffmerge&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">cmd</span> <span class="o">=</span> diffmerge <span class="se">\&quot;</span><span class="nv">$LOCAL</span><span class="se">\&quot;</span> <span class="se">\&quot;</span><span class="nv">$REMOTE</span><span class="se">\&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>merge<span class="o">]</span>
</span><span class='line'>  <span class="nv">tool</span> <span class="o">=</span> diffmerge
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mergetool <span class="s2">&quot;diffmerge&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">cmd</span> <span class="o">=</span> <span class="s2">&quot;diffmerge --merge --result=\&quot;$MERGED\&quot; \&quot;$LOCAL\&quot; \&quot;$(if test -f \&quot;$BASE\&quot;; then echo \&quot;$BASE\&quot;; else echo \&quot;$LOCAL\&quot;; fi)\&quot; \&quot;$REMOTE\&quot;&quot;</span>
</span><span class='line'>  <span class="nv">trustExitCode</span> <span class="o">=</span> <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can also directly edit the <code>.gitconfig</code> and manually add the config code.</p>

<h2>WinMerge 2.x on Windows</h2>

<p><a href="http://winmerge.org/">WinMerge</a> is an open source differencing and merging tool for Windows. It can compare both folders and files, presenting differences in a visual text format that is easy to understand and handle.
At the time of writing this blog post, WinMerge 3 is still in progress of development and no release yet. WinMerge 3 will be modern compare/synchronization tool. It will be based on Qt library and cross-platform. You can use the same tool in Windows and in Linux.
So for now and so on in this blog post, WinMerge term means WinMerge 2.x.</p>

<p>After installing WinMerge, to configure it as diff and merge tool of Git is by adding /editing the following config setting to <code>C:\Users\{UserName}\.gitconfig</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>mergetool<span class="o">]</span>
</span><span class='line'>  <span class="nv">prompt</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="nb">  </span><span class="nv">keepBackup</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="nb">  </span><span class="nv">keepTemporaries</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>merge<span class="o">]</span>
</span><span class='line'>  <span class="nv">tool</span> <span class="o">=</span> winmerge
</span><span class='line'>
</span><span class='line'><span class="o">[</span>mergetool <span class="s2">&quot;winmerge&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">name</span> <span class="o">=</span> WinMerge
</span><span class='line'>  <span class="nv">trustExitCode</span> <span class="o">=</span> <span class="nb">true</span>
</span><span class='line'><span class="nb">  </span><span class="nv">cmd</span> <span class="o">=</span> <span class="s2">&quot;/c/Program\\ Files\\ \\(x86\\)/WinMerge/WinMergeU.exe&quot;</span> -u -e -dl <span class="se">\&quot;</span>Local<span class="se">\&quot;</span> -dr <span class="se">\&quot;</span>Remote<span class="se">\&quot;</span> <span class="nv">$LOCAL</span> <span class="nv">$REMOTE</span> <span class="nv">$MERGED</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>diff<span class="o">]</span>
</span><span class='line'>  <span class="nv">tool</span> <span class="o">=</span> winmerge
</span><span class='line'>
</span><span class='line'><span class="o">[</span>difftool <span class="s2">&quot;winmerge&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">name</span> <span class="o">=</span> WinMerge
</span><span class='line'>  <span class="nv">trustExitCode</span> <span class="o">=</span> <span class="nb">true</span>
</span><span class='line'><span class="nb">  </span><span class="nv">cmd</span> <span class="o">=</span> <span class="s2">&quot;/c/Program\\ Files\\ \\(x86\\)/WinMerge/WinMergeU.exe&quot;</span> -u -e <span class="nv">$LOCAL</span> <span class="nv">$REMOTE</span>
</span></code></pre></td></tr></table></div></figure>


<p>The config above also can be configured by Git bash shell with <code>&ndash;global</code> parameter instead of manual edit via text editor.</p>

<p>Now, whenever you want it to launch diffs just use difftool[1]:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># diff the local file.m against the checked-in version</span>
</span><span class='line'><span class="nv">$ </span>git difftool file.m
</span><span class='line'>
</span><span class='line'><span class="c"># diff the local file.m against the version in some-feature-branch</span>
</span><span class='line'><span class="nv">$ </span>git difftool some-feature-branch file.m
</span><span class='line'>
</span><span class='line'><span class="c"># diff the file.m from the Build-54 tag to the Build-55 tag</span>
</span><span class='line'><span class="nv">$ </span>git difftool Build-54..Build-55 file.m
</span></code></pre></td></tr></table></div></figure>


<p>To resolve merge conflicts</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git mergetool
</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<ol>
<li><a href="http://twobitlabs.com/2011/08/install-diffmerge-git-mac-os-x/">http://twobitlabs.com/2011/08/install-diffmerge-git-mac-os-x/</a></li>
<li><a href="http://winmerge.org/">http://winmerge.org/</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/04/arduino-and-neo-6m-gps-module/">Arduino and NEO-6M GPS Module</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-05-04T08:32:17+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>8:32 am</span></time>
        
           | <a href="/blog/2017/05/04/arduino-and-neo-6m-gps-module/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2017/05/04/arduino-and-neo-6m-gps-module/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/arduino.png">
Couple days ayo, I met a friend of mine when I was at university. He plays extensively with <a href="http://www.arduino.org">Arduino</a>, <a href="https://www.raspberrypi.org">Raspberry Pi</a>, <a href="http://www.orangepi.org">Orange Pi</a> and other IoT stuff. He showed me how interesting IoT is, include wiring modules, and surely its programming. I remember that a few months ago, I got Arduino kit with GPS module from another friend of mine. The items were idle since I have other things to do in my work. Yesterday, I just have a free time to play with the Arduino kit. And I never play or explore Arduino before.</p>

<p>On the first time exploring Arduino, the hardware I use are :</p>

<ol>
<li><a href="http://www.arduino.org/products/boards/arduino-uno">Arduino Uno</a></li>
<li><a href="https://www.aliexpress.com/store/product/GPS-Receiver-U-blox-NEO-6M-Module-with-Ceramic-Antenna-TTL-Interface-for-raspberry-pi-2/1266255_32365271431.html">GPS Module NEO-6M-0-001</a></li>
</ol>


<p>To get working Arduino with GPS module, I use <a href="https://github.com/mikalhart/TinyGPS">TinyGPS</a> library. TinyGPS is designed to provide most of the NMEA GPS functionality. The detail description about TinyGPS can found <a href="http://arduiniana.org/libraries/tinygps/">here</a>. TinyGPS is additional library for Arduino. So we need to install it before include it to our project. The steps of installation additional Arduino libraries can be found <a href="https://www.arduino.cc/en/Guide/Libraries">here</a></p>

<p>The table below shows wiring between Arduino and NEO-6M-0-001 GPS module</p>

<table>
<thead>
<tr>
<th> NEO-6M-0-001 GPS     </th>
<th> Arduino Uno      </th>
<th> Cable</th>
</tr>
</thead>
<tbody>
<tr>
<td> Vcc                  </td>
<td> Power 3.3 Volt   </td>
<td> Black</td>
</tr>
<tr>
<td> GND                  </td>
<td> GND              </td>
<td> White</td>
</tr>
<tr>
<td> TXD                  </td>
<td> RX pin 4         </td>
<td> Gray</td>
</tr>
<tr>
<td> RXD                  </td>
<td> TX pin 3         </td>
<td> Magenta</td>
</tr>
</tbody>
</table>


<p><p/></p>

<p><img class="center" src="/images/post/2017-05-04-neo-6m-0-0-001.png"></p>

<p><img class="center" src="/images/post/2017-05-04-arduino-uno.png"></p>

<p><img class="center" src="/images/post/2017-05-04-arduino-uno-gps.png"></p>

<p>To simplify our testing, I grab sample source code provided by <a href="https://github.com/mikalhart/TinyGPS">TinyGPS</a>. On This sample, I Set the data rate in bits per second (baud) for serial data transmission to 9600.</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;SoftwareSerial.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;TinyGPS.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/<em> This sample code demonstrates the normal use of a TinyGPS object.</span>
</span><span class='line'><span class="cm">   It requires the use of SoftwareSerial, and assumes that you have a</span>
</span><span class='line'><span class="cm">   4800-baud serial GPS device hooked up on pins 4(rx) and 3(tx).</span>
</span><span class='line'><span class="cm"></em>/</span>
</span><span class='line'>
</span><span class='line'><span class="n">TinyGPS</span> <span class="n">gps</span><span class="p">;</span>
</span><span class='line'><span class="n">SoftwareSerial</span> <span class="nf">ss</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">smartdelay</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ms</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_float</span><span class="p">(</span><span class="kt">float</span> <span class="n">val</span><span class="p">,</span> <span class="kt">float</span> <span class="n">invalid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prec</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_int</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">invalid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_date</span><span class="p">(</span><span class="n">TinyGPS</span> <span class="o">&amp;</span><span class="n">gps</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_str</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o"><em></span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">//Serial.begin(115200);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Testing TinyGPS library v. &quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">TinyGPS</span><span class="o">::</span><span class="n">library_version</span><span class="p">());</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;by Mikal Hart&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Sats HDOP Latitude  Longitude  Fix  Date       Time     Date Alt    Course Speed Card  Distance Course Card  Chars Sentences Checksum&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;          (deg)     (deg)      Age                      Age  (m)    &mdash; from GPS &mdash;-  &mdash;- to London  &mdash;-  RX    RX        Fail&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//ss.begin(4800);</span>
</span><span class='line'>  <span class="n">ss</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
</span><span class='line'>  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">flat</span><span class="p">,</span> <span class="n">flon</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">age</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">chars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sentences</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">failed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">LONDON_LAT</span> <span class="o">=</span> <span class="mf">51.508131</span><span class="p">,</span> <span class="n">LONDON_LON</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.128002</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">satellites</span><span class="p">(),</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_SATELLITES</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">hdop</span><span class="p">(),</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_HDOP</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">gps</span><span class="p">.</span><span class="n">f_get_position</span><span class="p">(</span><span class="o">&amp;</span><span class="n">flat</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">age</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_float</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_float</span><span class="p">(</span><span class="n">flon</span><span class="p">,</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_AGE</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_date</span><span class="p">(</span><span class="n">gps</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_float</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">f_altitude</span><span class="p">(),</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ALTITUDE</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_float</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">f_course</span><span class="p">(),</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_float</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">f_speed_kmph</span><span class="p">(),</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_SPEED</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_str</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">f_course</span><span class="p">()</span> <span class="o">==</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span> <span class="o">?</span> <span class="s">&quot;</em><strong> &quot;</span> <span class="o">:</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">cardinal</span><span class="p">(</span><span class="n">gps</span><span class="p">.</span><span class="n">f_course</span><span class="p">()),</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">flat</span> <span class="o">==</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span> <span class="o">?</span> <span class="mh">0xFFFFFFFF</span> <span class="o">:</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">TinyGPS</span><span class="o">::</span><span class="n">distance_between</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">flon</span><span class="p">,</span> <span class="n">LONDON_LAT</span><span class="p">,</span> <span class="n">LONDON_LON</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_float</span><span class="p">(</span><span class="n">flat</span> <span class="o">==</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span> <span class="o">?</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="nl">GPS_INVALID_F_ANGLE</span> <span class="p">:</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">course_to</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">flon</span><span class="p">,</span> <span class="n">LONDON_LAT</span><span class="p">,</span> <span class="n">LONDON_LON</span><span class="p">),</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_str</span><span class="p">(</span><span class="n">flat</span> <span class="o">==</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_F_ANGLE</span> <span class="o">?</span> <span class="s">&quot;</strong><em> &quot;</span> <span class="o">:</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">cardinal</span><span class="p">(</span><span class="n">TinyGPS</span><span class="o">::</span><span class="n">course_to</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">flon</span><span class="p">,</span> <span class="n">LONDON_LAT</span><span class="p">,</span> <span class="n">LONDON_LON</span><span class="p">)),</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">gps</span><span class="p">.</span><span class="n">stats</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chars</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sentences</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">failed</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">failed</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">smartdelay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">smartdelay</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ms</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">available</span><span class="p">())</span>
</span><span class='line'>      <span class="n">gps</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">read</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">ms</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_float</span><span class="p">(</span><span class="kt">float</span> <span class="n">val</span><span class="p">,</span> <span class="kt">float</span> <span class="n">invalid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prec</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">invalid</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">&ndash;</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;</em>&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">prec</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">abs</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">flen</span> <span class="o">=</span> <span class="n">prec</span> <span class="o">+</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// . and -</span>
</span><span class='line'>    <span class="n">flen</span> <span class="o">+=</span> <span class="n">vi</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="n">vi</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">vi</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">flen</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">smartdelay</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_int</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">invalid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">sz</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">invalid</span><span class="p">)</span>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="s">&quot;<strong><strong><strong><em>&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="s">&quot;%ld&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sz</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">strlen</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>    <span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="n">sz</span><span class="p">[</span><span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
</span><span class='line'>  <span class="n">smartdelay</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_date</span><span class="p">(</span><span class="n">TinyGPS</span> <span class="o">&amp;</span><span class="n">gps</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">year</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">hundredths</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">age</span><span class="p">;</span>
</span><span class='line'>  <span class="n">gps</span><span class="p">.</span><span class="n">crack_datetime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">year</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">month</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">day</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hour</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">minute</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">second</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hundredths</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">age</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">==</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_AGE</span><span class="p">)</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</em></strong></strong></strong><strong><em> </em></strong><em>**** &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">sz</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span><span class='line'>    <span class="n">sprintf</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="s">&quot;%02d/%02d/%02d %02d:%02d:%02d &quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">print_int</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">TinyGPS</span><span class="o">::</span><span class="n">GPS_INVALID_AGE</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">smartdelay</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_str</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o"></em></span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">slen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">slen</span> <span class="o">?</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">:</span> <span class="sc">&#39; &#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">smartdelay</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The output of this testing on Serial monitor showed as follow.</p>

<p><img class="center" src="/images/post/2017-05-04-output.png"></p>

<p>If you do not get similar output as above (get <code>*</code> on table output) it means your arduino fails get data from GPS module. Please ensure your GPS led is blinking which indicate it receives data from the GPS satellites.</p>

<p>The other thing that you should ensure is you have the right wiring. RX of the Arduino (pin 4, according to the <code>SoftwareSerial</code> statement) goes to the TX of the GPS. Arduino pin 3 (ss TX) goes to the GPS RX.</p>

<p>To validate the accuracy of GPS output (Latitude, Longitude) showed on Arduino Serial Monitor you can check it on google map.</p>

<h2>References</h2>

<p><ul>
<li><a href="https://www.u-blox.com/sites/default/files/products/documents/NEO-6_DataSheet_(GPS.G6-HW-09005).pdf">NEO-6 u-blox 6 GPS Modules Data Sheet</a></li>
<li><a href="http://www.ayomaonline.com/iot/gy-gps6mv2-neo6mv2-neo-6m-gps-module-with-arduino-usb-ttl/">GY-GPS6MV2 – NEO6MV2 (NEO 6M) GPS MODULE WITH ARDUINO / USB TTL</a></li>
<li><a href="https://arduino.stackexchange.com/questions/24235/arduino-softwareserial-cant-get-data-from-neo-6m-gps-module">Arduino SoftwareSerial - can&rsquo;t get data from NEO 6M-GPS module</a></li>
<ul></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/04/17/import-existing-git-repository-to-another/">Import Existing Git Repository to Another</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-17T17:44:53+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>5:44 pm</span></time>
        
           | <a href="/blog/2017/04/17/import-existing-git-repository-to-another/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2017/04/17/import-existing-git-repository-to-another/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/git.png"></p>

<p>While working with git, we may need to import source code from an existing git repository to our working copy. Merging it and pushing to origin master.
The scenario that I had was :</p>

<p><br/></p>

<ul>
<li> I have a project template that I store on a git repository. Let say the url is <code>http://server/git/template.git</code>
   <img class="center" src="/images/post/2017-04-17-template.png">
</li>
<li>
I have another git repository with url <code>http://server/git/project1.git</code>
   <img class="center" src="/images/post/2017-04-17-project1.png">
</li>
</ul>


<p>What I need from the two repositories are importing all contents (libraries, sources, etc) from <code>template</code> repository into my <code>project1</code> working copy. Since I don&rsquo;t want to coding from zero. To get into what I need, here are the steps.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># git clone project1</span>
</span><span class='line'><span class="nv">$ </span>git clone http://server/git/project1.git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>project1
</span><span class='line'>
</span><span class='line'><span class="c"># add remote url named REMOTE.TEMPLATE</span>
</span><span class='line'><span class="nv">$ </span>git remote add REMOTE.TEMPLATE http://server/git/template.git
</span><span class='line'>
</span><span class='line'><span class="c"># fetch from REMOTE.TEMPLATE remote url</span>
</span><span class='line'><span class="nv">$ </span>git fetch REMOTE.TEMPLATE
</span><span class='line'>
</span><span class='line'><span class="c"># checkout REMOTE.TEMPLATE/master and create a new branch called TEMPLATE</span>
</span><span class='line'><span class="nv">$ </span>git checkout -b TEMPLATE REMOTE.TEMPLATE/master
</span><span class='line'>
</span><span class='line'><span class="c">#switch back to master branch</span>
</span><span class='line'><span class="nv">$ </span>git checkout master
</span><span class='line'>
</span><span class='line'><span class="c"># merge TEMPLATE brach to master branch</span>
</span><span class='line'><span class="nv">$ </span>git merge TEMPLATE
</span><span class='line'>
</span><span class='line'><span class="c"># commit changes</span>
</span><span class='line'><span class="nv">$ </span>git commit
</span></code></pre></td></tr></table></div></figure>


<p>The next step is checking the merge result on our working copy of master branch.
If what we have been imported already there, now we can remove the remote URL of REMOTE.TEMPLATE
and TEMPLATE branch to get rid of the extra branch before pushing.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># remove REMOTE.TEMPLATE remote address</span>
</span><span class='line'><span class="nv">$ </span>git remote rm REMOTE.TEMPLATE
</span><span class='line'>
</span><span class='line'><span class="c"># remove template branch. It is useful to get rid of the extra branch before pushing</span>
</span><span class='line'><span class="nv">$ </span>git branch -d TEMPLATE
</span><span class='line'>
</span><span class='line'><span class="c"># push to remote origin/master</span>
</span><span class='line'><span class="nv">$ </span>git push
</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/1683531/how-to-import-existing-git-repository-into-another">http://stackoverflow.com/questions/1683531/how-to-import-existing-git-repository-into-another</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/03/27/working-with-multiple-github-account-on-a-computer/">Working With Multiple Github Account on a Computer</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-03-27T00:47:22+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>12:47 am</span></time>
        
           | <a href="/blog/2017/03/27/working-with-multiple-github-account-on-a-computer/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2017/03/27/working-with-multiple-github-account-on-a-computer/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/git.png">
Source control is one of a basic need for software development, especially when we work on a team. Git is one of popular distributed source control. Working with multiple github account on the same computer need a few tricky way. Let&rsquo;s assume we have cloned the repository from github to local computer. The following ways are the simple ways I got on internet.</p>

<h2>Change Remote URL to HTTPS</h2>

<p>This way is by changing the remote URL to HTTPS with the following format.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git remote <span class="nb">set</span>-url origin https://USERNAME@github.com/USERNAME/PROJECTNAME.git
</span></code></pre></td></tr></table></div></figure>


<p>Then do normal git operation such as <code>commit</code>, <code>push</code> etc.
To ensure that the commits appear as performed by USERNAME, we can configure the username and email on our working directory.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git config user.name USERNAME
</span><span class='line'><span class="nv">$ </span>git config user.email USERNAME@example.com
</span></code></pre></td></tr></table></div></figure>


<h2>Multiple SSH Key</h2>

<p>The other way is by using multiple SSH key. <a href="https://code.tutsplus.com/tutorials/quick-tip-how-to-work-with-github-and-multiple-accounts--net-22574">Here</a> is the complete tutorial by <a href="https://twitter.com/jeffrey_way">Jeffrey Way</a></p>

<h2>References</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/3860112/multiple-github-accounts-on-the-same-computer">http://stackoverflow.com/questions/3860112/multiple-github-accounts-on-the-same-computer</a></li>
<li><a href="https://code.tutsplus.com/tutorials/quick-tip-how-to-work-with-github-and-multiple-accounts--net-22574">https://code.tutsplus.com/tutorials/quick-tip-how-to-work-with-github-and-multiple-accounts--net-22574</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/12/30/c-plus-plus-set-with-custom-comparator/">C++ Set With Custom Comparator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-12-30T10:42:04+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:42 am</span></time>
        
           | <a href="/blog/2016/12/30/c-plus-plus-set-with-custom-comparator/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2016/12/30/c-plus-plus-set-with-custom-comparator/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/cpp.png"></p>

<p><code>std::set</code> is a C++ STL container that store unique elements following a specific order. It is defined in the <code>set</code> header file.
<br/></p>

<p>Benefits and Features of <code>std::set</code>[3]:</p>

<p><ol>
<li>It’s doesn’t allow duplicate elements i.e. it only contains unique elements</li>
<li>
<code>std::set</code> can contain element of any specified type in template argument
</li>
<li>
<code>std::set</code> internally store elements in balanced binary tree
</li>
<li>
 By default <code>std::set</code> uses the operator <code> &lt; </code> for comparing two elements and but if user passes the external sorting criteria i.e. comparator then it uses it instead of default operator <code> &lt; </code>.
</li>
<li>
<code>std::set</code> will keep the inserted elements in sorted order based on the assigned sorting criteria i.e. either by default criteria operator <code> &lt; </code> or by passed comparator (if passed).
</li></p>

<p>In this post the samples only limited to <code>std::set</code> that use custom comparator and store complex object instead of basic data type. The complex object that we will use is reusing class <code>Person</code> on previous post.</p>

<p>Let&rsquo;s create custom class that handles comparation process</p>

<p><figure class='code'><figcaption><span>CustomCompare</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#ifndef CustomCompare_h</span>
</span><span class='line'><span class="cp">#define CustomCompare_h</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;Person.hpp&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">CustomCompare</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">lhs</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">getAge</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif </span><span class="cm">/<em> CustomCompare_h </em>/</span><span class="cp"></span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The following code is an example how to use the comparator class in <code>std:set</code>
<figure class='code'><figcaption><span>sample how to use</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">void</span> <span class="nf">SampleSetWithCustomCompare</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">set</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span><span class="n">CustomCompare</span><span class="o">&gt;</span> <span class="n">setOfPersons</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">setOfPersons</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 1&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">));</span>
</span><span class='line'>    <span class="n">setOfPersons</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 2&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">));</span>
</span><span class='line'>    <span class="n">setOfPersons</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 3&quot;</span><span class="p">,</span> <span class="mi">28</span><span class="p">));</span>
</span><span class='line'>    <span class="n">setOfPersons</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 4&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span><span class="n">CustomCompare</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">setOfPersons</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span><span class="o">!=</span><span class="n">setOfPersons</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , age : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">getAge</span><span class="p">()</span><span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2>References</h2>

<ol>
<li><a href="http://www.cplusplus.com/reference/set/set/">http://www.cplusplus.com/reference/set/set/</a></li>
<li><a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-C-2nd-Edition.productCd-0470932449.html">http://www.wrox.com/WileyCDA/WroxTitle/Professional-C-2nd-Edition.productCd-0470932449.html</a></li>
<li><a href="http://thispointer.com/stdset-tutorial-part-1-set-usage-details-with-default-sorting-criteria/">http://thispointer.com/stdset-tutorial-part-1-set-usage-details-with-default-sorting-criteria/</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/12/29/c-plus-plus-priority-queue-with-comparator/">C++ Priority Queue With Comparator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-12-29T15:52:23+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>3:52 pm</span></time>
        
           | <a href="/blog/2016/12/29/c-plus-plus-priority-queue-with-comparator/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2016/12/29/c-plus-plus-priority-queue-with-comparator/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/cpp.png"></p>

<p><code>priority_queue</code> is categorized as a STL container adaptor. It is like a queue that keeps its element in sorted order. Instead of a strict FIFO ordering, the element at the head of the queue at any given time is the one with the highest priority.</p>

<p>The template class definition of <code>priority_queue</code> is as follow</p>

<figure class='code'><figcaption><span>template definition</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">template</span> <span class="o">&lt;</span>
</span><span class='line'>   <span class="k">class</span> <span class="nc">Type</span><span class="p">,</span>
</span><span class='line'>   <span class="k">class</span> <span class="nc">Container</span><span class="o">=</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;</span><span class="p">,</span>
</span><span class='line'>   <span class="k">class</span> <span class="nc">Compare</span><span class="o">=</span><span class="n">less</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span> <span class="o">&gt;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">priority_queue</span>
</span></code></pre></td></tr></table></div></figure>


<p>A user-provided compare can be supplied to change the ordering, e.g. using <code>std::greater<T></code> would cause the smallest element to appear as the top(). We also can create custom comparator for our need.</p>

<p>Many samples available on net about <code>priority_queue</code> with default compare parameter. In this article let&rsquo;s create samples by specifying the compare parameter template.</p>

<figure class='code'><figcaption><span>priority_queue with std::greater</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">//helper function displays sorted data</span>
</span><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="kt">void</span> <span class="n">printQueue</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">q</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>        <span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">SamplePriorityQueue</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="nl">n</span> <span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">})</span>
</span><span class='line'>        <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">printQueue</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code above uses <code>std::greater</code> as a compare parameter template.</p>

<figure class='code'><figcaption><span>output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>0
</span><span class='line'>1
</span><span class='line'>2
</span><span class='line'>3
</span><span class='line'>4
</span><span class='line'>5
</span><span class='line'>6
</span><span class='line'>7
</span><span class='line'>8
</span><span class='line'>9
</span></code></pre></td></tr></table></div></figure>


<p>Beside the <code>std::less</code> or <code>std::greater</code>, we can create our custom comparator with lamda or custom class or struct.</p>

<figure class='code'><figcaption><span>lamda as compare parameter</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">void</span> <span class="nf">SamplePriorityQueueWithLamda</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// using lambda to compare elements.</span>
</span><span class='line'>    <span class="k">auto</span> <span class="n">compare</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">lhs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="k">return</span> <span class="n">lhs</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">;</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">compare</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">compare</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="nl">n</span> <span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">})</span>
</span><span class='line'>        <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">printQueue</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To use the custom comparator, we just need to pass it as the third parameter of <code>priority_queue</code> template</p>

<figure class='code'><figcaption><span>custom comparator</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">struct</span> <span class="n">CustomCompare</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">lhs</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>sample with custom comparator</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">void</span> <span class="nf">SamplePriorityQueueWithCustomComparator</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">priority_queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">CustomCompare</span> <span class="o">&gt;</span> <span class="n">pq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>    <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">printQueue</span><span class="p">(</span><span class="n">pq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The data stored in <code>priority_queue</code> is not limited to basic data type.
We can store object in it. Let&rsquo;s create a sample of it.
Let&rsquo;s say we have a <code>Person</code> class.</p>

<figure class='code'><figcaption><span>Person.hpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#ifndef Person_hpp</span>
</span><span class='line'><span class="cp">#define Person_hpp</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="n">Person</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Person</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">);</span>
</span><span class='line'>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Person</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">string</span> <span class="n">getName</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">getAge</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</span><span class='line'>    <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span><span class="o">:</span>
</span><span class='line'>    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif </span><span class="cm">/* Person_hpp */</span><span class="cp"></span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Person.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#include &quot;Person.hpp&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">bool</span> <span class="k">operator</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">getAge</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">bool</span> <span class="k">operator</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Person</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">getAge</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span><span class="o">:</span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Person</span><span class="o">::~</span><span class="n">Person</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">string</span> <span class="n">Person</span><span class="o">::</span><span class="n">getName</span><span class="p">()</span> <span class="k">const</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">Person</span><span class="o">::</span><span class="n">getAge</span><span class="p">()</span> <span class="k">const</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">age</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the <code>Person</code> class, we have friend overloading methods, right angle bracket and left angle bracket. The methods act as comparation operator. The operator overloading is needed if we want to use <code>std::less</code> or <code>std::greater</code>.</p>

<figure class='code'><figcaption><span>sample priority_queue stores object</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">void</span> <span class="nf">SamplePriorityQueueStoreObject</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personVector</span> <span class="o">=</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 1&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
</span><span class='line'>        <span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 2&quot;</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
</span><span class='line'>        <span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 3&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
</span><span class='line'>        <span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 4&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
</span><span class='line'>        <span class="n">Person</span><span class="p">(</span><span class="s">&quot;Person 5&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;======== Less Priority Queue ======= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">less</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;::</span><span class="n">value_type</span><span class="o">&gt;&gt;</span> <span class="n">pqueue_less</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//fill pqueue_less</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">personVector</span><span class="p">.</span><span class="n">cbegin</span><span class="p">();</span> <span class="n">it</span><span class="o">!=</span><span class="n">personVector</span><span class="p">.</span><span class="n">cend</span><span class="p">();</span> <span class="n">it</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">pqueue_less</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//iterate,display and pop</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">pqueue_less</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Person</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pqueue_less</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
</span><span class='line'>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">pqueue_less</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;======== Greater Priority Queue ======= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">greater</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;::</span><span class="n">value_type</span><span class="o">&gt;&gt;</span> <span class="n">pqueue_greater</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//fill pqueue_greater</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">personVector</span><span class="p">.</span><span class="n">cbegin</span><span class="p">();</span> <span class="n">it</span><span class="o">!=</span><span class="n">personVector</span><span class="p">.</span><span class="n">cend</span><span class="p">();</span> <span class="n">it</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">pqueue_greater</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//iterate,display and pop</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">pqueue_greater</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Person</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pqueue_greater</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
</span><span class='line'>        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">pqueue_greater</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<ol>
<li><a href="http://en.cppreference.com/w/cpp/container/priority_queue">http://en.cppreference.com/w/cpp/container/priority_queue</a></li>
<li><a href="https://support.microsoft.com/en-us/kb/837697">https://support.microsoft.com/en-us/kb/837697</a></li>
<li><a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-C-2nd-Edition.productCd-0470932449.html">http://www.wrox.com/WileyCDA/WroxTitle/Professional-C-2nd-Edition.productCd-0470932449.html</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/09/reset-git-credential-on-os-x-keychain/">Reset Git Credential on OS X Keychain</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-11-09T13:40:34+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:40 pm</span></time>
        
           | <a href="/blog/2016/11/09/reset-git-credential-on-os-x-keychain/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2016/11/09/reset-git-credential-on-os-x-keychain/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/git.png">
This post basically just a note for my self. In case I got the same condition in the next, it can help me to remember what I did in the past.</p>

<p>I got a condition which I have just changed my git password. Surely I cannot pull or push since my local credential was not valid anymore. When I run <code>git config &ndash;list</code>, I believe my git password stored on OS X Keychain. The simple way I do was running a command via terminal :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git config credential.helper osxkeychain
</span></code></pre></td></tr></table></div></figure>


<p>I was then prompted to input my username and password. By inputing my username and new password everything back to normal.</p>

<p>If you want it to apply globally just append parameter <code> &ndash;global </code> to the command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git config --global credential.helper osxkeychain
</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/20195304/how-to-update-password-for-git">http://stackoverflow.com/questions/20195304/how-to-update-password-for-git</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/12/ubuntu-server-does-not-recognize-virtualbox-adapter/">Ubuntu Server Does Not Recognize VirtualBox Adapter</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-12T22:25:24+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:25 pm</span></time>
        
           | <a href="/blog/2016/10/12/ubuntu-server-does-not-recognize-virtualbox-adapter/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2016/10/12/ubuntu-server-does-not-recognize-virtualbox-adapter/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As we know, VirtualBox provides several adapters that we can add and be used by OS guest.
At the time of writing this post, I have an OS X (host) and Ubuntu Server 16.04.1 LTS (guest). The needs are, I want to be able to remote my Ubuntu from OS X terminal. I also want my Ubuntu guest can connect to internet. I have configured two network adapters for the guest (NAT and host-only).</p>

<p>When I run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ifconfig
</span></code></pre></td></tr></table></div></figure>


<p>The first/default adapter (NAT) <code>enp0s3</code> is recognized without any problems by the guest. But not the second one (host-only). To make the second adapter visible, I have to run  a command</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo dhclient
</span><span class='line'><span class="nv">$ </span>ifconfig
</span></code></pre></td></tr></table></div></figure>


<p>Now I got both adapters <code>enp0s3</code> (NAT) and <code>enp0s8</code> (host-only) visible on terminal. And now I can ping and run ssh from host (OS X) to guest (Ubuntu server).</p>

<p>In order to make it permanent, we need to edit <code>/etc/network/interfaces</code> with the following lines</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># The second network interface</span>
</span><span class='line'>auto enp0s8
</span><span class='line'>iface enp0s8 inet dhcp
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the network service by running</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /etc/init.d/networking restart
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s my note for now and thanks for reading.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/19/mono-multiple-application-on-a-virtual-host/">Mono Multiple Application on a Virtual Host</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-19T23:06:13+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:06 pm</span></time>
        
           | <a href="/blog/2016/09/19/mono-multiple-application-on-a-virtual-host/#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io/blog/2016/09/19/mono-multiple-application-on-a-virtual-host/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/logo/mono.png">
On my previous post I wrote how to configure application virtual host. We can have multiple application in a virtual host like multiple application in a web site on IIS. To do that, the steps are the same as I did on my previous post. Let&rsquo;s say we have a scenario, having a site config as the sample on previous article, an application port 99, default document root <code>/var/www/vhosts/defaultsite/root</code>. The detail virtual host config as follow</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;VirtualHost</span> <span class="err">*:99</span><span class="nt">&gt;</span>
</span><span class='line'>    ServerAdmin admin@test.com
</span><span class='line'>    ServerName  neutro.local
</span><span class='line'>    ServerAlias neutrofoton.com *.neutrofoton.com
</span><span class='line'>
</span><span class='line'>    MonoServerPath neutro.local &quot;/usr/bin/mod-mono-server4&quot;
</span><span class='line'>    MonoDebug neutro.local true
</span><span class='line'>    MonoSetEnv neutro.local MONO_IOMAP=all
</span><span class='line'>    MonoApplications neutro.local &quot;/:/var/www/vhosts/defaultsite/root&quot;
</span><span class='line'>
</span><span class='line'>    MonoAutoApplication disabled
</span><span class='line'>    AddHandler  mono    .aspx .ascx .asax .ashx .config .cs .asmx .axd
</span><span class='line'>
</span><span class='line'>    DocumentRoot    /var/www/vhosts/defaultsite/root
</span><span class='line'>    DirectoryIndex  Default.aspx index.aspx index.html
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;Location</span> <span class="err">&quot;/&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      Allow from all
</span><span class='line'>      Order allow,deny
</span><span class='line'>    MonoSetServerAlias neutro.local
</span><span class='line'>      SetHandler mono
</span><span class='line'>      SetOutputFilter DEFLATE
</span><span class='line'>      SetEnvIfNoCase Request_URI &quot;\.(?:gif|jpe?g|png)$&quot; no-gzip dont-vary
</span><span class='line'>    <span class="nt">&lt;/Location&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;IfModule</span> <span class="err">mod_deflate.c</span><span class="nt">&gt;</span>
</span><span class='line'>      AddOutputFilterByType DEFLATE text/html text/plain text/xml text/javascript
</span><span class='line'>    <span class="nt">&lt;/IfModule&gt;</span>
</span><span class='line'>
</span><span class='line'>    LogLevel    debug
</span><span class='line'>
</span><span class='line'>    ErrorLog ${APACHE_LOG_DIR}/error.log
</span><span class='line'>    CustomLog ${APACHE_LOG_DIR}/access.log combined
</span><span class='line'><span class="nt">&lt;/VirtualHost&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The steps to enable site config is the same as privious post. To make virtual host have multiple applications, we have to modify the site config file as follow. In this sample, we are going to add 2 applications to this virtual host</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;VirtualHost</span> <span class="err">*:99</span><span class="nt">&gt;</span>
</span><span class='line'>    ServerAdmin admin@test.com
</span><span class='line'>    ServerName  neutro.local
</span><span class='line'>    ServerAlias neutrofoton.com *.neutrofoton.com
</span><span class='line'>
</span><span class='line'>    MonoServerPath neutro.local &quot;/usr/bin/mod-mono-server4&quot;
</span><span class='line'>    MonoDebug neutro.local true
</span><span class='line'>    MonoSetEnv neutro.local MONO_IOMAP=all
</span><span class='line'>    MonoApplications neutro.local &quot;/:/var/www/vhosts/defaultsite/root&quot;
</span><span class='line'>
</span><span class='line'>    MonoAutoApplication disabled
</span><span class='line'>    AddHandler  mono    .aspx .ascx .asax .ashx .config .cs .asmx .axd
</span><span class='line'>
</span><span class='line'>    DocumentRoot    /var/www/vhosts/defaultsite/root
</span><span class='line'>    DirectoryIndex  Default.aspx index.aspx index.html
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;Location</span> <span class="err">&quot;/&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      Allow from all
</span><span class='line'>      Order allow,deny
</span><span class='line'>    MonoSetServerAlias neutro.local
</span><span class='line'>      SetHandler mono
</span><span class='line'>      SetOutputFilter DEFLATE
</span><span class='line'>      SetEnvIfNoCase Request_URI &quot;\.(?:gif|jpe?g|png)$&quot; no-gzip dont-vary
</span><span class='line'>    <span class="nt">&lt;/Location&gt;</span>
</span><span class='line'>
</span><span class='line'>    Alias   /project1  &quot;/home/neutro/Workspace/dotnet/project1&quot;
</span><span class='line'>    MonoApplications project1 &quot;/project1:/home/neutro/Workspace/dotnet/project1&quot;
</span><span class='line'>    MonoServerPath project1 &quot;/usr/bin/mod-mono-server4&quot;
</span><span class='line'>    <span class="nt">&lt;Location</span> <span class="err">&quot;/project1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      Allow from all
</span><span class='line'>      Order allow,deny
</span><span class='line'>      MonoSetServerAlias project1
</span><span class='line'>      SetHandler mono
</span><span class='line'>      SetOutputFilter DEFLATE
</span><span class='line'>      SetEnvIfNoCase Request_URI &quot;\.(?:gif|jpe?g|png)$&quot; no-gzip dont-vary
</span><span class='line'>      Require all granted
</span><span class='line'>    <span class="nt">&lt;/Location&gt;</span>
</span><span class='line'>
</span><span class='line'>    Alias   /project2  &quot;/home/neutro/Workspace/dotnet/project2&quot;
</span><span class='line'>    MonoApplications project2 &quot;/project2:/home/neutro/Workspace/dotnet/project2&quot;
</span><span class='line'>    MonoServerPath project2 &quot;/usr/bin/mod-mono-server4&quot;
</span><span class='line'>    <span class="nt">&lt;Location</span> <span class="err">&quot;/project2&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      Allow from all
</span><span class='line'>      Order allow,deny
</span><span class='line'>      MonoSetServerAlias project2
</span><span class='line'>      SetHandler mono
</span><span class='line'>      SetOutputFilter DEFLATE
</span><span class='line'>      SetEnvIfNoCase Request_URI &quot;\.(?:gif|jpe?g|png)$&quot; no-gzip dont-vary
</span><span class='line'>      Require all granted
</span><span class='line'>    <span class="nt">&lt;/Location&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;IfModule</span> <span class="err">mod_deflate.c</span><span class="nt">&gt;</span>
</span><span class='line'>      AddOutputFilterByType DEFLATE text/html text/plain text/xml text/javascript
</span><span class='line'>    <span class="nt">&lt;/IfModule&gt;</span>
</span><span class='line'>
</span><span class='line'>    LogLevel    debug
</span><span class='line'>
</span><span class='line'>    ErrorLog ${APACHE_LOG_DIR}/error.log
</span><span class='line'>    CustomLog ${APACHE_LOG_DIR}/access.log combined
</span><span class='line'><span class="nt">&lt;/VirtualHost&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the new virtual host configuration we have:</p>

<ol>
<li><code>/project1</code>, with physical application&rsquo;s files in <code>/home/neutro/Workspace/dotnet/project1</code></li>
<li><code>/project2</code>, with physical application&rsquo;s files in <code>/home/neutro/Workspace/dotnet/project2</code></li>
</ol>


<p>Let&rsquo;s assume we have a simple <code>index.aspx</code> file in <code>/home/neutro/Workspace/dotnet/project1</code> and <code>/home/neutro/Workspace/dotnet/project2</code></p>

<p>We need to give access to both folders and theirs file contents</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find project1 -type d -exec chmod <span class="m">755</span> <span class="o">{}</span> <span class="se">\;</span>
</span><span class='line'><span class="nv">$ </span>find project1 -type f -exec chmod <span class="m">644</span> <span class="o">{}</span> <span class="se">\;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>find project2 -type d -exec chmod <span class="m">755</span> <span class="o">{}</span> <span class="se">\;</span>
</span><span class='line'><span class="nv">$ </span>find project2 -type f -exec chmod <span class="m">644</span> <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After modifying the config file and give access to the application directories, we need to register the applications in <code>/etc/mono-server4/debian.webapp</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;apps&gt;</span>
</span><span class='line'>   <span class="nt">&lt;web-application&gt;</span>
</span><span class='line'>        <span class="nt">&lt;name&gt;</span>project1<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;vpath&gt;</span>/project1<span class="nt">&lt;/vpath&gt;</span>
</span><span class='line'>        <span class="nt">&lt;path&gt;</span>/home/neutro/Workspace/dotnet/project1<span class="nt">&lt;/path&gt;</span>
</span><span class='line'>        <span class="nt">&lt;vhost&gt;</span>neutro.local<span class="nt">&lt;/vhost&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/web-application&gt;</span>
</span><span class='line'>    <span class="nt">&lt;web-application&gt;</span>
</span><span class='line'>        <span class="nt">&lt;name&gt;</span>project2<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;vpath&gt;</span>/project2<span class="nt">&lt;/vpath&gt;</span>
</span><span class='line'>        <span class="nt">&lt;path&gt;</span>/home/neutro/Workspace/dotnet/project2<span class="nt">&lt;/path&gt;</span>
</span><span class='line'>        <span class="nt">&lt;vhost&gt;</span>neutro.local<span class="nt">&lt;/vhost&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/web-application&gt;</span>
</span><span class='line'><span class="nt">&lt;/apps&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The final step is restart apache, and now we should be able to open in browser <a href="http://localhost:99/project1">http://localhost:99/project1</a> or <a href="http://localhost:99/project2.">http://localhost:99/project2.</a></p>

<h2>References</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/19279286/fail-to-start-a-mono-site-with-apache2-404-error-with-mod-mono">http://stackoverflow.com/questions/19279286/fail-to-start-a-mono-site-with-apache2-404-error-with-mod-mono</a></li>
</ol>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Me</h1>
  <img class="left" src="/images/me.png" alt="Drawing" style="width: 100px;height:100px"/>
  <p>
    No many things to write about me here, except the one who enjoy feeding koi fish and have interest in computer technology. Especially programming, control engineering, artificial intelligent and math. Please feel free to update me if I miss something in blog post. You can reach me at <i class="fa fa-envelope-o"></i>neutrofoton[at]gmail.com
  </p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/09/14/create-and-consume-c-plus-plus-class-dll-on-windows/">Create and Consume C++ Class DLL on Windows</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/10/winmerge-and-diffmerge-as-git-diff-merge-tool/">WinMerge and DiffMerge as Git Diff Merge Tool</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/04/arduino-and-neo-6m-gps-module/">Arduino and NEO-6M GPS Module</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/17/import-existing-git-repository-to-another/">Import Existing Git Repository to Another</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/27/working-with-multiple-github-account-on-a-computer/">Working With Multiple Github Account on a Computer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/30/c-plus-plus-set-with-custom-comparator/">C++ Set With Custom Comparator</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/29/c-plus-plus-priority-queue-with-comparator/">C++ Priority Queue With Comparator</a>
      </li>
    
  </ul>
</section>
<!--
<section>
  <h1>Categories</h1>
  <ul id="category-list">
    
    
    <li><a href="/blog/categories/csharp/index.html">csharp ( 10 )</a></li>
    
    
    <li><a href="/blog/categories/php/index.html">php ( 3 )</a></li>
    
    
    <li><a href="/blog/categories/osx/index.html">osx ( 12 )</a></li>
    
    
    <li><a href="/blog/categories/apache/index.html">apache ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/mysql/index.html">mysql ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/java/index.html">java ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/mono/index.html">mono ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/aspnet/index.html">aspnet ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/pattern/index.html">pattern ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/eclipse/index.html">eclipse ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/xcode/index.html">xcode ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/xamarin/index.html">xamarin ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/octopress/index.html">octopress ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/ios/index.html">ios ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/mathematic/index.html">mathematic ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/javascript/index.html">javascript ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/spring/index.html">spring ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/code-block/index.html">code block ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/visual-studio/index.html">visual studio ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/linux/index.html">linux ( 5 )</a></li>
    
    
    <li><a href="/blog/categories/windows/index.html">windows ( 3 )</a></li>
    
    
    <li><a href="/blog/categories/cpp/index.html">cpp ( 5 )</a></li>
    
    
    <li><a href="/blog/categories/virtualbox/index.html">virtualbox ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/git/index.html">git ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/arduino/index.html">arduino ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/c/index.html">c ( 1 )</a></li>
    
  </ul>
</section>
-->
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/apache/' class='badge1' data-badge='4'>apache</a></li>
<li class='category'><a href='/blog/categories/arduino/' class='badge1' data-badge='1'>arduino</a></li>
<li class='category'><a href='/blog/categories/aspnet/' class='badge1' data-badge='1'>aspnet</a></li>
<li class='category'><a href='/blog/categories/c/' class='badge1' data-badge='1'>c</a></li>
<li class='category'><a href='/blog/categories/code-block/' class='badge1' data-badge='1'>code block</a></li>
<li class='category'><a href='/blog/categories/cpp/' class='badge1' data-badge='5'>cpp</a></li>
<li class='category'><a href='/blog/categories/csharp/' class='badge1' data-badge='10'>csharp</a></li>
<li class='category'><a href='/blog/categories/eclipse/' class='badge1' data-badge='2'>eclipse</a></li>
<li class='category'><a href='/blog/categories/git/' class='badge1' data-badge='4'>git</a></li>
<li class='category'><a href='/blog/categories/ios/' class='badge1' data-badge='2'>ios</a></li>
<li class='category'><a href='/blog/categories/java/' class='badge1' data-badge='4'>java</a></li>
<li class='category'><a href='/blog/categories/javascript/' class='badge1' data-badge='1'>javascript</a></li>
<li class='category'><a href='/blog/categories/linux/' class='badge1' data-badge='5'>linux</a></li>
<li class='category'><a href='/blog/categories/mathematic/' class='badge1' data-badge='1'>mathematic</a></li>
<li class='category'><a href='/blog/categories/mono/' class='badge1' data-badge='4'>mono</a></li>
<li class='category'><a href='/blog/categories/mysql/' class='badge1' data-badge='1'>mysql</a></li>
<li class='category'><a href='/blog/categories/octopress/' class='badge1' data-badge='1'>octopress</a></li>
<li class='category'><a href='/blog/categories/osx/' class='badge1' data-badge='12'>osx</a></li>
<li class='category'><a href='/blog/categories/pattern/' class='badge1' data-badge='2'>pattern</a></li>
<li class='category'><a href='/blog/categories/php/' class='badge1' data-badge='3'>php</a></li>
<li class='category'><a href='/blog/categories/spring/' class='badge1' data-badge='1'>spring</a></li>
<li class='category'><a href='/blog/categories/virtualbox/' class='badge1' data-badge='2'>virtualbox</a></li>
<li class='category'><a href='/blog/categories/visual-studio/' class='badge1' data-badge='2'>visual studio</a></li>
<li class='category'><a href='/blog/categories/windows/' class='badge1' data-badge='3'>windows</a></li>
<li class='category'><a href='/blog/categories/xamarin/' class='badge1' data-badge='1'>xamarin</a></li>
<li class='category'><a href='/blog/categories/xcode/' class='badge1' data-badge='4'>xcode</a></li>

  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'neutrofoton',
            count: 0,
            skip_forks: true,
            target: '#gh_repos',
            skip_repo: 'neutrofoton'+'.github.io'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
  <h1>Site I Visit</h1>
  <ul id="site_i_visit">

      <li class="post">
        <a href="http://www.cppreference.com">C++ Reference</a>
      </li>

  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - neutro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'neutrofoton';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
