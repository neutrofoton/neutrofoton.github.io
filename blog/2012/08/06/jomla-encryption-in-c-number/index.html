
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Jomla Encryption in C# - neutrofoton</title>
  <meta name="author" content="neutro">

  
  <meta name="description" content="Couple days ago I got a task to migrate user from an existing website which build based on Jomla CMS to an ASP.NET website user. Both of them use &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://neutrofoton.github.io/blog/2012/08/06/jomla-encryption-in-c-number/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="neutrofoton" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<style>
article img {
  border: 0;
}
aside.sidebar img {
  border-color: #e0e0e0;
}
article img, article video, article .flash-video{
  box-shadow: rgba(255,255,255,0.15) 0 1px 4px;
}
</style>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">neutrofoton</a></h1>
  
    <h2>Science, Technology and Life</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="neutrofoton.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <!--<li><a href="/about">About</a></li>-->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Jomla Encryption in C#</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-08-06T09:21:53+07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>9:21 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://neutrofoton.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Couple days ago I got a task to migrate user from an existing website which build based on Jomla CMS to an ASP.NET website user. Both of them use different encryption technique. The plan was that the Jomla based website would be replaced with the .NET website. In sort the scenario was :</p>

<ol>
<li>Replace PHP website build on top Jomla CMS with .NET</li>
<li>Migrate users from Jomla so they can login into the new .NET website using old password</li>
<li>Migrate some roles</li>
</ol>


<p>The first thing that come to my mind is to check whether they use the different encryption algorithm or not. And yupâ€¦they use different algorithm :( . So I decide to extend the <code>MembershipProvider</code> used by the .NET. In my case, thankfully I just need to override one method on that is <code>ValidateUser</code>. I will not talk the the detail what inside the methods is. The main point is just to validate if user login using existing password created by jomla can be validated by the .NET. To do that I create a simple class called <code>JomlaEncryption</code> to validate if user enter valid Jomla password.</p>

<figure class='code'><figcaption><span>encrypt with jomla algorithm</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">JomlaEncryption</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsValidPassword</span><span class="p">(</span><span class="kt">string</span> <span class="n">password</span><span class="p">,</span> <span class="kt">string</span> <span class="n">encryptedPassword</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">EncryptUsingJomlaAlgorithm</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">encryptedPassword</span><span class="p">)</span> <span class="p">==</span> <span class="n">encryptedPassword</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>    <span class="c1">/// Source : http://stackoverflow.com/questions/2727043/using-php-to-create-a-joomla-user-password</span>
</span><span class='line'>    <span class="c1">///   From joomla Forum, that&#39;s what happen behind:</span>
</span><span class='line'>    <span class="c1">///</span>
</span><span class='line'>    <span class="c1">///   1. Generate a password</span>
</span><span class='line'>    <span class="c1">///   2. Generate 32 random characters</span>
</span><span class='line'>    <span class="c1">///   3. Concatenate 1 and 2</span>
</span><span class='line'>    <span class="c1">///   4. md5(3)</span>
</span><span class='line'>    <span class="c1">///   5. store 4:2</span>
</span><span class='line'>    <span class="c1">///   Example:</span>
</span><span class='line'>    <span class="c1">///</span>
</span><span class='line'>    <span class="c1">///   1. Generate a password - we&#39;ll use &#39;password&#39;</span>
</span><span class='line'>    <span class="c1">///   2. Generate 32 random characters - we&#39;ll use &#39;WnvTroeiBmd5bjGmmsVUnNjppadH7giK&#39;</span>
</span><span class='line'>    <span class="c1">///   3. Concatenate 1 and 2 - passwordWnvTroeiBmd5bjGmmsVUnNjppadH7giK</span>
</span><span class='line'>    <span class="c1">///   4. md5(3) - 3c57ebfec712312f30c3fd1981979f58</span>
</span><span class='line'>    <span class="c1">///   5. store 4:2 - 3c57ebfec712312f30c3fd1981979f58:WnvTroeiBmd5bjGmmsVUnNjppadH7giK</span>
</span><span class='line'>    <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'>    <span class="c1">/// &lt;param name=&quot;password&quot;&gt;</span>
</span><span class='line'>    <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">string</span> <span class="nf">EncryptUsingJomlaAlgorithm</span><span class="p">(</span><span class="kt">string</span> <span class="n">password</span><span class="p">,</span> <span class="kt">string</span> <span class="n">encryptedPassword</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(!</span><span class="n">encryptedPassword</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">))</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">string</span> <span class="n">randChar32Bit</span> <span class="p">=</span> <span class="n">encryptedPassword</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">)[</span><span class="m">1</span><span class="p">];</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">randChar32Bit</span><span class="p">)</span> <span class="p">||</span> <span class="n">randChar32Bit</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">32</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">string</span> <span class="n">concatePassAndRandChar32Bit</span> <span class="p">=</span> <span class="n">password</span> <span class="p">+</span> <span class="n">randChar32Bit</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">string</span> <span class="n">hashedConcatePassAndRandChar32Bit</span> <span class="p">=</span> <span class="n">MD5</span><span class="p">(</span><span class="n">concatePassAndRandChar32Bit</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0}:{1}&quot;</span><span class="p">,</span> <span class="n">hashedConcatePassAndRandChar32Bit</span><span class="p">,</span> <span class="n">randChar32Bit</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">static</span> <span class="kt">string</span> <span class="nf">MD5</span><span class="p">(</span><span class="kt">string</span> <span class="n">password</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">byte</span><span class="p">[]</span> <span class="n">bytes</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
</span><span class='line'>        <span class="k">try</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Cryptography</span><span class="p">.</span><span class="n">MD5CryptoServiceProvider</span> <span class="n">cryptProvider</span><span class="p">;</span>
</span><span class='line'>            <span class="n">cryptProvider</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Cryptography</span><span class="p">.</span><span class="n">MD5CryptoServiceProvider</span><span class="p">();</span>
</span><span class='line'>            <span class="kt">byte</span><span class="p">[]</span> <span class="n">hash</span> <span class="p">=</span> <span class="n">cryptProvider</span><span class="p">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
</span><span class='line'>            <span class="kt">string</span> <span class="n">ret</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span><span class='line'>            <span class="k">foreach</span> <span class="p">(</span><span class="kt">byte</span> <span class="n">a</span> <span class="k">in</span> <span class="n">hash</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="p">&lt;</span> <span class="m">16</span><span class="p">)</span>
</span><span class='line'>                    <span class="n">ret</span> <span class="p">+=</span> <span class="s">&quot;0&quot;</span> <span class="p">+</span> <span class="n">a</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="k">else</span>
</span><span class='line'>                    <span class="n">ret</span> <span class="p">+=</span> <span class="n">a</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">catch</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s all for now and thanks for reading :)</p>
</div>


  <footer>
    <p class="meta">
      <a href="javascript:window.print()" class="print-button">Print</a>


  

<span class="byline author vcard">Posted by <span class="fn">neutro</span></span>

      




<time class='entry-date' datetime='2012-08-06T09:21:53+07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>9:21 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/csharp/'>csharp</a>, <a class='category' href='/blog/categories/php/'>php</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://neutrofoton.github.io/blog/2012/08/06/jomla-encryption-in-c-number/" data-via="" data-counturl="http://neutrofoton.github.io/blog/2012/08/06/jomla-encryption-in-c-number/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/08/03/json-serializer/" title="Previous Post: Json Serializer">&laquo; Json Serializer</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/08/08/configure-apache-on-os-x-10-dot-8-mountain-lion/" title="Next Post: Configure Apache on OS X 10.8 Mountain Lion">Configure Apache on OS X 10.8 Mountain Lion &raquo;</a>
      
    </p>
  </footer>
</article>

  <section id="comments">
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Me</h1>
  <img class="left" src="/images/me.png" alt="Drawing" style="width: 100px;height:100px"/>
  <p>
    No many things to write about me here, except the one who enjoy feeding koi fish and have interest in computer technology. Especially programming, control engineering, artificial intelligent and math. Please feel free to update me if I miss something in blog post. You can reach me at <i class="fa fa-envelope-o"></i>neutrofoton[at]gmail.com
  </p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/11/09/reset-git-credential-on-os-x-keychain/">Reset Git Credential on OS X Keychain</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/12/ubuntu-server-does-not-recognize-virtualbox-adapter/">Ubuntu Server Does Not Recognize VirtualBox Adapter</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/19/mono-multiple-application-on-a-virtual-host/">Mono Multiple Application on a Virtual Host</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/18/mono-mod-mono-apache2-on-ubuntu/">Mono Mod_mono Apache2 on Ubuntu</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/17/virtualbox-share-host-folder-ubuntu-guest/">VirtualBox Share Host Folder Ubuntu Guest</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/11/lambda-in-c-plus-plus/">Lambda in C++</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/27/configure-boost-c-plus-plus-on-xcode/">Configure Boost (C++ Libraries) on Xcode, Code::Blocks and Visual Studio</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="category-list">
    
    
    <li><a href="/blog/categories/csharp/index.html">csharp ( 10 )</a></li>
    
    
    <li><a href="/blog/categories/php/index.html">php ( 3 )</a></li>
    
    
    <li><a href="/blog/categories/osx/index.html">osx ( 11 )</a></li>
    
    
    <li><a href="/blog/categories/apache/index.html">apache ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/mysql/index.html">mysql ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/java/index.html">java ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/mono/index.html">mono ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/aspnet/index.html">aspnet ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/pattern/index.html">pattern ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/eclipse/index.html">eclipse ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/xcode/index.html">xcode ( 4 )</a></li>
    
    
    <li><a href="/blog/categories/xamarin/index.html">xamarin ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/octopress/index.html">octopress ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/ios/index.html">ios ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/mathematic/index.html">mathematic ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/javascript/index.html">javascript ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/spring/index.html">spring ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/code-block/index.html">code block ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/visual-studio/index.html">visual studio ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/linux/index.html">linux ( 5 )</a></li>
    
    
    <li><a href="/blog/categories/windows/index.html">windows ( 1 )</a></li>
    
    
    <li><a href="/blog/categories/cpp/index.html">cpp ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/virtualbox/index.html">virtualbox ( 2 )</a></li>
    
    
    <li><a href="/blog/categories/git/index.html">git ( 1 )</a></li>
    
  </ul>
</section>




<section>
  <h1>Site I Visit</h1>
  <ul id="site_i_visit">

      <li class="post">
        <a href="http://www.cppreference.com">C++ Reference</a>
      </li>

  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - neutro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'neutrofoton';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://neutrofoton.github.io/blog/2012/08/06/jomla-encryption-in-c-number/';
        var disqus_url = 'http://neutrofoton.github.io/blog/2012/08/06/jomla-encryption-in-c-number/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
